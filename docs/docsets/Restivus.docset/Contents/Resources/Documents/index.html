<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Restivus  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Restivus  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Restivus Docs</a> (34% documented)</p>
        <p class="header-right"><a href="https://github.com/ryanbaldwin/Restivus"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Restivus Reference</a>
        <img id="carat" src="img/carat.png" />
        Restivus  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AnyRestable.html">AnyRestable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/HTTPError.html">HTTPError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HTTPMethod.html">HTTPMethod</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HttpResponseCode.html">HttpResponseCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Result.html">Result</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ResultFormat.html">ResultFormat</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/HTTPURLResponse.html">HTTPURLResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLRequest.html">URLRequest</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Authenticating.html">Authenticating</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Deletable.html">Deletable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Gettable.html">Gettable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Patchable.html">Patchable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Postable.html">Postable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Puttable.html">Puttable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Restable.html">Restable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Typealiases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:8Restivus3Rawa">Raw</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='restivus' class='heading'>Restivus</h1>

<blockquote>
<p><em>Finally!</em> A Restivus for the rest of us!</p>
</blockquote>

<p>Yes, it&rsquo;s true, this library is named after the infamous <a href="https://www.youtube.com/watch?v=HX55AzGku5Y"><em>Festivus</em> Seinfeld episode</a>. I had no choice, as my initial name, RestEasy, was <a href="http://resteasy.jboss.org">already taken by the JBoss Community</a>, and I don&rsquo;t wanna mess with them.</p>
<h2 id='what-the-heck-is-restivus' class='heading'>What the heck is Restivus?</h2>

<p>Restivus is a mostly protocol based approach to creating structured HTTP requests and responses. It&rsquo;s simple, easy, and is built around Swift 4&rsquo;s <code>Codable</code> protocol.</p>
<h2 id='a-quick-example' class='heading'>A quick example</h2>

<p>Lets say we have a Login endpoint which we want to model. The endpoint accepts an username and a password via an HTTP Post. Upon successful login, the endpoint will return an inflated user. For this example the user will simply be a <code>name</code>, <code>age</code>, and <code>sex</code>. Something like the following:</p>
<pre class="highlight plaintext"><code>struct User {
    enum Sex: String, Codable {
        case male, female
    }

    var name: String
    var age: Int
    var sex: Sex
}
extension User: Codable {}

struct LoginRequest: Encodable {
    var username: String
    var password: String
}

extension LoginRequest: Postable {
    typealias ResponseType = User

    var baseUrl: String { return "https://myserver.ca/api/v1" }

    var path: String { return "/login" }
}

let request = LoginRequest(username: "Jerry", password: "Hellooooooo!")
request.submit() { result in 
    // We get a Result enum, which on success will hold the inflated Decodable 
    // (as defined by the ResponseType typealias, above)
    // and a Restivus.HTTPError on failure.
    switch result {
    case let .success(user):
        // a successful call will return to us a fully inflated User struct
        print(user)
    case let .failure(error):
        // There can be several reasons for failure, which we won't get into here
        print(error)
    }
}
</code></pre>
<h3 id='an-explanation' class='heading'>An Explanation</h3>

<p>Lets breakdown the above. We&rsquo;ll start with the conformance to the <code>Postable</code> protocol by the `LoginRequest:</p>
<pre class="highlight plaintext"><code>extension LoginRequest: Postable
</code></pre>

<p>The <code>Postable</code> protocol is what turns our <code>LoginRequest</code> into a <code>POST</code> request. Restivus has a few different HTTP method protocols for commonly used request types: <code>Gettable</code>, <code>Deletable</code>, <code>Patchable</code>, <code>Postable</code>, and <code>Puttable</code>. Each one maps to its respective method.</p>

<p>All of these protocols inherit from <code>Restable</code>, which in turn defines the conformance requirements and bulk of the functionality for any request. Its children (<code>Gettable</code> and the rest of the crew) provide sensible defaults for creating the actual underlying <code>URLRequest</code>.</p>

<p>Next is the <code>ResponseType</code>:</p>
<pre class="highlight plaintext"><code>typealias ResponseType = User
</code></pre>

<p>This defines what the returned payload should be deserialized into. In our case, the Login endpoint will return some JSON describing a User (as we structured above). </p>

<p>Following that are the two properties, <code>baseUrl</code> and <code>path</code>. </p>
<pre class="highlight plaintext"><code>var baseUrl: String {
    "https://myserver.ca/api/v1"
}

var path: String {
    "/login"
}
</code></pre>

<p>These are pretty self explanatory. They are defined in the <code>Restable</code> protocol, and default to empty strings. In my experience, the <code>baseUrl</code> will typically be the same value for most, if not all the requests. As such, it&rsquo;s a bit of a pain in the butt to repeat that same property over and over again. Since Swift allows for protocol extensions, it&rsquo;s easier to have a global extension of <code>Restable</code> that returns a sensible default for <code>baseUrl</code>. </p>

<p>For example, if we were going to create several requests for our <code>myserver.ca</code> endpoint, it makes more sense to do the following:</p>
<pre class="highlight plaintext"><code>extension Restable {
    var baseUrl: String { return "https://myserver.ca/api/v1" }
}
</code></pre>

<p>This also works well if you have different servers for different environments that are determined at runtime, from a configuration. By extending <code>Restable</code> to have a default for <code>baseUrl</code>, we can then omit it from our <code>Postable</code> conformance:</p>
<pre class="highlight plaintext"><code>extension LoginRequest: Postable {
    typealias ResponseType = User
    var path: String { "/login" }
}
</code></pre>

<p>Finally, lets talk about what the conforming our <code>LoginRequest</code> to <code>Encodable</code> will do:</p>
<pre class="highlight plaintext"><code>struct LoginRequest: Encodable {}
</code></pre>

<p>If you submit a <code>Restable</code> which conforms to <code>Encodable</code>, then Restivus will serialize that Restable into JSON and submit it as the body of the request. In our case, the following JSON will be submitted in the body of the <code>LoginRequest</code>:</p>
<pre class="highlight plaintext"><code>{
    "username": "Jerry",
    "password": "Hellooooooo!"
}
</code></pre>

<p>If you&rsquo;d like to get a bit more of a feel for Swift 4&rsquo;s <code>Codable</code> (which is just a combination of <code>Encodable &amp; Decodable</code>), put the following into a Playground.</p>
<pre class="highlight plaintext"><code>import Foundation

struct User: Codable {
    enum Sex: String, Codable {
        case male, female
    }

    var name: String
    var age: Int
    var sex: Sex
}

let user = User(name: "Ryan", age: 38, sex: .male)
var encoder = JSONEncoder()
encoder.outputFormatting = .prettyPrinted
let data = try! encoder.encode(user)
print(String(data: data, encoding: .utf8)!)

let inflatedUser = try! JSONDecoder().decode(User.self, from: data)
</code></pre>
<h2 id='more-info' class='heading'>More Info</h2>

<p>Over the coming weeks I&rsquo;ll be writing a full fledged Wiki on the various how-to&rsquo;s and such of Restivus. So stay tuned. In the meantime I encourage you to <a href="docs/index.html">go peruse the Docs</a> (likely best to clone the repo locally and view the files there, as GitHub is just going to show you the source).</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2017 <a class="link" href="https://github.com/ryanbaldwin" target="_blank" rel="external">Ryan Baldwin</a>. All rights reserved. (Last updated: 2017-09-29)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.8.3</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
